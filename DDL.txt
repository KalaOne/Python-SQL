CREATE TABLE Staff
(
	StaffID INTEGER,
	Name VARCHAR(40)
);
CREATE TABLE Product
(
	ProductID INTEGER,
	Name VARCHAR(40)
);
CREATE TABLE Customer
(
	CustomerID INTEGER,
	Name VARCHAR(40),
	Email VARCHAR(40)
);
CREATE TABLE Ticket
(
	TicketID INTEGER,
	Problem VARCHAR(1000),
	Status VARCHAR(20),
	Priority INTEGER,
	LoggedTime TIMESTAMP,
	CustomerID INTEGER,
	ProductID INTEGER
);
CREATE TABLE TicketUpdate
(
	TicketUpdateID INTEGER,
	Message VARCHAR(1000),
	UpdateTime TIMESTAMP,
	TicketID INTEGER,
	StaffID INTEGER
);


ALTER TABLE Staff
ADD PRIMARY KEY (StaffID);
CREATE INDEX StaffIndex ON Staff (StaffID);

ALTER TABLE Product
ADD PRIMARY KEY (ProductID);
CREATE INDEX ProductIndex ON Product (ProductID);

ALTER TABLE Customer
ADD PRIMARY KEY (CustomerID);
CREATE INDEX CustIndex ON Customer (CustomerID);

ALTER TABLE Ticket
ADD PRIMARY KEY (TicketID),
ADD FOREIGN KEY (ProductID) REFERENCES Product(ProductID) ON DELETE RESTRICT ON UPDATE CASCADE,
ADD FOREIGN KEY (CustomerID) REFERENCES Customer(CustomerID) ON DELETE RESTRICT ON UPDATE CASCADE,
ADD CONSTRAINT ChkStatus CHECK (Status ='Open' OR Status ='open' OR  Status = 'Closed' or Status ='closed'),
ADD CONSTRAINT ChkPriority CHECK (Priority >= 1 AND Priority <= 3);
CREATE INDEX TicketIndex ON Ticket (TicketID);

------------- ALTER TABLE Ticket ALTER COLUMN LoggedTime SET DEFAULT CURRENT_TIMESTAMP; ----------

ALTER TABLE TicketUpdate
ADD PRIMARY KEY (TicketUpdateID),
ADD FOREIGN KEY (TicketID) REFERENCES Ticket(TicketID) ON DELETE RESTRICT ON UPDATE CASCADE,
ADD FOREIGN KEY (StaffID) REFERENCES Staff(StaffID) ON DELETE RESTRICT ON UPDATE CASCADE;
CREATE INDEX TicketUpdIndex ON TicketUpdate (TicketUpdateID);

ALTER TABLE Staff ALTER COLUMN Name SET NOT NULL;
ALTER TABLE Product ALTER COLUMN Name SET NOT NULL;
ALTER TABLE Customer ALTER COLUMN Name SET NOT NULL;
ALTER TABLE Customer ALTER COLUMN Email SET NOT NULL;
ALTER TABLE Ticket ALTER COLUMN Problem SET NOT NULL;
ALTER TABLE Ticket ALTER COLUMN Status SET NOT NULL;
ALTER TABLE Ticket ALTER COLUMN Priority SET NOT NULL;
ALTER TABLE Ticket ALTER COLUMN LoggedTime SET NOT NULL;
ALTER TABLE TicketUpdate ALTER COLUMN Message SET NOT NULL;
ALTER TABLE TicketUpdate ALTER COLUMN UpdateTime SET NOT NULL;
